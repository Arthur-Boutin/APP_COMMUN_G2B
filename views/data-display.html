<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Temp Control Club</title>
    <link href="../assets/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="../assets/images/logo.ico" type="icon"/>
    <!-- Intégration de la bibliothèque Chart.js pour les graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
<div class="container container-data">
    <header>
        <h1>Affichage des données</h1>
    </header>

    <main>
        <!-- Bouton de bascule entre la vue liste et la vue cartes -->
        <div class="toggle-container">
            <button id="toggleViewBtn" class="form-btn">Passer à la vue Cartes</button>
        </div>

        <!-- Vue Liste -->
        <div id="listView" class="section">
            <h2>Derniers relevés des capteurs</h2>
            <div class="actuator-list" id="sensor-reading">
                <ul class="simple-readings-list">
                    <?php foreach ($lastSensorsReadings as $reading): ?>
                        <li><?= htmlspecialchars($reading) ?></li>
                    <?php endforeach; ?>
                </ul>
            </div>

            <h2>Dernières activations des actionneurs</h2>
            <div class="actuator-list" id="actuator-states">
                <ul class="simple-readings-list">
                    <?php foreach ($lastActuatorsReadings as $reading): ?>
                        <li><?= htmlspecialchars($reading) ?></li>
                    <?php endforeach; ?>
                </ul>
            </div>
        </div>

        <!-- Vue Cartes -->
        <div id="buttonView" class="section hidden">
            <h2>Capteurs</h2>
            <div class="data-buttons-grid">
                <?php foreach ($lastSensorsReadings as $readingString):
                    // Extrait la description du capteur de la chaîne pour le titre de la carte
                    preg_match('/^(.*?)\s*:/', $readingString, $matches);
                    $description = isset($matches[1]) ? trim($matches[1]) : 'Capteur Inconnu';
                ?>
                    <div class="data-display-card">
                        <h3><?= htmlspecialchars($description) ?></h3>
                        <p class="data-value-full"><?= htmlspecialchars($readingString) ?></p>
                    </div>
                <?php endforeach; ?>
            </div>

            <h2>Actionneurs</h2>
            <div class="data-buttons-grid">
                <?php foreach ($lastActuatorsReadings as $readingString):
                    // Extrait la description de l'actionneur de la chaîne pour le titre de la carte
                    preg_match('/^(.*?)\s*-/', $readingString, $matches);
                    $description = isset($matches[1]) ? trim($matches[1]) : 'Actionneur Inconnu';
                ?>
                    <div class="data-display-card">
                        <h3><?= htmlspecialchars($description) ?></h3>
                        <p class="data-value-full"><?= htmlspecialchars($readingString) ?></p>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>

        <!-- Section pour les Graphiques -->
        <div class="section">
            <h2>Historique des Capteurs</h2>
            <div class="toggle-container">
                <button id="toggleTemperatureChartBtn" class="form-btn">Masquer le graphique de Température</button>
            </div>
            <div class="chart-container" id="temperatureChartContainer">
                <canvas id="temperatureChart"></canvas>
            </div>

            <div class="toggle-container">
                <button id="toggleHumidityChartBtn" class="form-btn">Masquer le graphique d'Humidité</button>
            </div>
            <div class="chart-container" id="humidityChartContainer">
                <canvas id="humidityChart"></canvas>
            </div>

            <div class="toggle-container">
                <button id="toggleLightChartBtn" class="form-btn">Masquer le graphique de Luminosité</button>
            </div>
            <div class="chart-container" id="lightChartContainer">
                <canvas id="lightChart"></canvas>
            </div>

            <div class="toggle-container">
                <button id="toggleDistanceChartBtn" class="form-btn">Masquer le graphique de Distance</button>
            </div>
            <div class="chart-container" id="distanceChartContainer">
                <canvas id="distanceChart"></canvas>
            </div>

            <div class="toggle-container">
                <button id="toggleSoundChartBtn" class="form-btn">Masquer le graphique de Son</button>
            </div>
            <div class="chart-container" id="soundChartContainer">
                <canvas id="soundChart"></canvas>
            </div>
        </div>
    </main>
</div>

<script src="../assets/js/data-button-graphics.js"></script>

</body>
</html>